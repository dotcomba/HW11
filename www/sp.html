<!DOCTYPE html>
<head>
       <meta charset="utf-8" />
        <meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
        <meta name="format-detection" content="telephone=no" />
        <meta name="msapplication-tap-highlight" content="no" />
        <!-- WARNING: for iOS 7, remove the width=device-width and height=device-height attributes. See https://issues.apache.org/jira/browse/CB-4323 -->
        <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height, target-densitydpi=device-dpi" />
        <title>SP Office 365</title>
<script src="Scripts/jquery-1.4.1.min.js" type="text/javascript"></script>

    <script type="text/javascript">

        function login(userID, password, url, successBlock, failBlock) {
  
            $.ajax({
                url: 'https://login.microsoftonline.com/login.srf',
                dataType: 'text', type: 'POST',
                data: getSAMLRequest(userID, password, url),
                headers: {
                    Accept: "application/soap+xml; charset=utf-8"
                },
                success: function (result, textStatus, jqXHR) {
                    alert('soap');
                       $('#result').html(result);
                    var xmlDoc = $.parseXML(result);
                    var xml = $(xmlDoc)
                    var securityToken = xml.find("BinarySecurityToken").text();

                    if (securityToken.length == 0) {
                        failBlock();
                    }
                    else {
                        $.ajax({ url: url, dataType: 'text',
                            type: 'POST',
                            data: xml.find("BinarySecurityToken").text(),
                            headers: {
                                Accept: "application/x-www-form-urlencoded"
                            },
                            success: function (result, textStatus, jqXHR) {
                                successBlock();
                            },
                            error: function (jqXHR, textStatus, errorThrown) {
                                failBlock();
                            }
                        });
                    }
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    failBlock();
                }
            });
        }
        function getSAMLRequest(userID, password, url) {
            
            return '<s:Envelope xmlns:s="http://www.w3.org/2003/05/soap-envelope" xmlns:a="http://www.w3.org/2005/08/addressing" xmlns:u="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-utility-1.0.xsd">' +
'<s:Header><a:Action s:mustUnderstand="1">http://schemas.xmlsoap.org/ws/2005/02/trust/RST/Issue</a:Action><a:ReplyTo><a:Address>http://www.w3.org/2005/08/addressing/anonymous</a:Address></a:ReplyTo><a:To s:mustUnderstand="1">https://login.microsoftonline.com/extSTS.srf</a:To>' +
'<o:Security s:mustUnderstand="1" xmlns:o="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd"><o:UsernameToken>' +
'<o:Username>' + userID + '</o:Username>' +
'<o:Password>' + password + '</o:Password>' +
'</o:UsernameToken>' +
'</o:Security>' +
'</s:Header>' +
'<s:Body>' +
'<t:RequestSecurityToken xmlns:t="http://schemas.xmlsoap.org/ws/2005/02/trust">' +
'<wsp:AppliesTo xmlns:wsp="http://schemas.xmlsoap.org/ws/2004/09/policy">' +
'<a:EndpointReference>' +
'<a:Address>' + url + '</a:Address>' +
'</a:EndpointReference>' +
'</wsp:AppliesTo>' +
'<t:KeyType>http://schemas.xmlsoap.org/ws/2005/05/identity/NoProofKey</t:KeyType>' +
'<t:RequestType>http://schemas.xmlsoap.org/ws/2005/02/trust/Issue</t:RequestType>' +
'<t:TokenType>urn:oasis:names:tc:SAML:1.0:assertion</t:TokenType>' + '</t:RequestSecurityToken>' + '</s:Body>' +
'</s:Envelope>';
        }

        $(document).ready(function () {
            alert('blya');
            login('admin@dotcomba.onmicrosoft.com', '!dotcomdemo2015', 'https://dotcomba-public.sharepoint.com/_forms/default.aspx?wa=wsignin1.0',
            //success block - lets test with a simple SP API GET 
function () {
    alert('success');
    $.ajax({
        url: "https://dotcomba-public.sharepoint.com/_api/web/title",
        dataType: 'text',
        success: function (data) {
            alert('yes');
            // $('#result').html(data);
        },
        error: function (request, status, error) {
            alert(error);
            $("#result").html("<div class='btn btn-danger'>Ошибка</div>&nbsp; Ошибка в процессе обработки запроса " + error);
        }
    });
},
            //fail block 
function () {
    alert('fail :(')
});

        }); 
    </script>
</head>
​
<body>
Мы в шарапоинте
    <div id='result'>
    </div>
</body>
​</html> 